# Reproducible Research: Peer Assessment 1

In this assignment we have been asked to write a report that answers the questions detailed below. The entire assignement must be completed in a single R markdown document that can be processed by knitr and be transformed into an HTML file. The present file represents the mentioned file.

First, let's make sure that the code is always included in the report by default.

```{r, echo=TRUE}
library(knitr)
opts_chunk$set(echo = TRUE)
```


## Getting the data
The first thing is to check if the zip file has already been downloaded. If not, download it.
```{r}
url <- "https://d396qusza40orc.cloudfront.net/repdata%2Fdata%2Factivity.zip"
zip.file <- "activity.zip"
file <- "activity.csv"

if(!file.exists(zip.file)) {
    download.file(url, destfile = zip.file)
    }
```

If the data is not unzipped yet, extract it to the current directory.
```{r}
if(!file.exists(file)) {
    unzip(zip.file)
    }
```

## Loading and preprocessing the data

We read the data:
```{r}
data <- read.csv("activity.csv")
```

Is the data in its correct format?
```{r}
str(data)
```

The date variable is read as a factor, not a date. Let's correct that.
```{r}
data$date <- as.Date(as.character(data$date))
str(data)
```

Ok, that's better. Let's do the homework now.

## What is mean total number of steps taken per day?
Let's first calculate the total number of steps per day. We will use for this the ddply function, that requires the plyr library.
```{r}
library(plyr)
data.day <- ddply(data, .(date), summarize, sum=sum(steps))
```

Let's plot the histogram with the total number of steps taken per day. We will do it with the ggplot2 library.
```{r, fig.width=6, fig.height=4}
library(ggplot2)
graph <- ggplot(data.day, aes(x=sum))
graph <- graph + geom_histogram(binwidth=1000)
graph <- graph + labs(title = "Histogram of number of steps per day",
                      x = "Steps per day", y = "Count")
print(graph)
```

Let's see what are the mean and median of the total steps per day.
```{r}
data.mean <- mean(data.day$sum, na.rm=TRUE)
data.median <- median(data.day$sum, na.rm=TRUE)
```

The mean of the set is `r data.mean`and its median is `r data.median`.

## What is the average daily activity pattern?
For this question we must first calculate the average number of steps per interval.
```{r}
data.interval <- ddply(data, .(interval), summarize, avg=mean(steps, na.rm=TRUE))
```

Let's see the shape it has over the day. 
```{r, fig.width=6, fig.height=4}
graph <- ggplot(data.interval, aes(x=interval, y=avg))
graph <- graph + geom_line()
graph <- graph + labs(title = "Average number of steps per interval over a day",
                      x = "Interval", y = "Average steps per day")
print(graph)
```

There is a clear spike in the graph. Let's find to which interval it corresponds.
```{r}
max.interval <- data.interval[data.interval$avg == max(data.interval$avg),][1]
```
The 5-minute interval with the maximum average number of steps, on average across all the days in the data set, is `r max.interval`. 

## Imputing missing values
There are missing values in the data set, identified with NA values. Let's see how many of those there are.
```{r}
data.missing <- data[is.na(data$steps),]
nrow(data.missing)
```

That is quite a high number of missing values. Let's try to fill them using the average value per interval for the dataset. This is going to be done directly into a new dataset called data.completed.
```{r}
data.completed <- data
for (day in unique(data.missing$date)) {
    data.completed[data.completed$date == day, ]$steps <- data.interval$avg
}
```
Let's check we have no missing values now.
```{r}
nrow(data.completed[is.na(data.completed$steps),])
```

Now let's recalculate the mean total number of steps taken per day, as previously done.

Let's first calculate the total number of steps per day.
```{r}
new.data.day <- ddply(data.completed, .(date), summarize, sum=sum(steps))
```

Let's plot the histogram with the total number of steps taken per day. We will do it with the ggplot2 library.
```{r, fig.width=6, fig.height=4}
library(ggplot2)
graph <- ggplot(new.data.day, aes(x=sum))
graph <- graph + geom_histogram(binwidth=1000)
graph <- graph + labs(title = "Histogram of number of steps per day",
                      x = "Steps per day", y = "Count")
print(graph)
```

The graph appears to be exactly the same but for an increase of the bar of 10.000-11.000 steps, which is the logical impact of substituting the NA values with the mean values for intervals.

Let's see what are the mean and median of the total steps per day.
```{r}
new.data.mean <- mean(new.data.day$sum)
new.data.median <- median(new.data.day$sum)
```

The mean of the new set without NAs is `r new.data.mean`and its median is `r new.data.median`. In the previous set it was `r data.mean`and its median is `r data.median`. Similarly, the difference is minimal.

## Are there differences in activity patterns between weekdays and weekends?
